/* 移动端视口高度处理 - 专门处理小屏幕和微信浏览器 */

/* 基础移动端视口处理 */
@media screen and (max-width: 768px) {
    /* 使用CSS环境变量处理移动端视口高度 */
    #ai-chat-x-main-layout {
        height: 100vh;
        height: 100dvh; /* 动态视口高度 - 排除地址栏 */
        height: 100svh; /* 小视口高度 - 移动端优化 */
        overflow: hidden !important;
    }
    
    #ai-chat-x-main-layout > div.ant-layout {
        height: calc(100vh - 50px);
        height: calc(100dvh - 50px);
        height: calc(100svh - 50px);
        overflow: hidden !important;
    }
    
    #ai-chat-x-history {
        height: calc(100vh - 240px);
        height: calc(100dvh - 240px);
        height: calc(100svh - 240px);
        maxHeight: calc(100dvh - 240px);
        maxHeight: calc(100svh - 240px);
    }
}

/* 超小屏幕处理 (390px × 844px) */
@media screen and (max-width: 480px) and (max-height: 900px) {
    /* 进一步优化超小屏幕的布局 */
    #ai-chat-x-main-layout {
        height: 100vh;
        height: 100dvh;
        height: 100svh;
    }
    
    /* 调整页首高度 */
    #ai-chat-x-header {
        height: 45px !important;
        min-height: 45px !important;
    }
    
    .ai-chat-x-header-row {
        height: 40px !important;
        min-height: 40px !important;
        padding: 8px 16px !important;
    }
    
    /* 调整主体布局高度 */
    #ai-chat-x-main-layout > div.ant-layout {
        height: calc(100vh - 45px);
        height: calc(100dvh - 45px);
        height: calc(100svh - 45px);
    }
    
    /* 调整聊天历史高度 */
    #ai-chat-x-history {
        height: calc(100vh - 235px);
        height: calc(100dvh - 235px);
        height: calc(100svh - 235px);
        maxHeight: calc(100dvh - 235px);
        maxHeight: calc(100svh - 235px);
    }
    
    /* 优化字体大小 */
    #ai-chat-x-main-layout {
        font-size: 13px !important;
    }
    
    #ai-chat-x-header .ant-btn {
        font-size: 13px !important;
        padding: 4px 8px !important;
    }
    
    /* 优化输入区域 - 保持原始padding，只在小屏幕下调整 */
    #ai-chat-x-input-container {
        /* 保持原始padding: 16px 24px，不覆盖 */
    }
    
    /* 优化按钮大小 */
    .unified-button {
        width: 36px !important;
        height: 36px !important;
    }
}

/* 微信浏览器特殊处理 */
@media screen and (max-width: 768px) and (-webkit-min-device-pixel-ratio: 2) {
    /* 微信浏览器使用更保守的高度计算 */
    #ai-chat-x-main-layout {
        height: 100vh;
        height: 100dvh;
        /* 微信浏览器可能不支持svh，使用dvh作为降级 */
    }
    
    #ai-chat-x-main-layout > div.ant-layout {
        height: calc(100vh - 50px);
        height: calc(100dvh - 50px);
    }
    
    #ai-chat-x-history {
        height: calc(100vh - 240px);
        height: calc(100dvh - 240px);
        maxHeight: calc(100dvh - 240px);
    }
}

/* 横屏模式处理 */
@media screen and (max-width: 844px) and (orientation: landscape) {
    /* 横屏时进一步压缩高度 */
    #ai-chat-x-header {
        height: 40px !important;
        min-height: 40px !important;
    }
    
    .ai-chat-x-header-row {
        height: 35px !important;
        min-height: 35px !important;
        padding: 6px 12px !important;
    }
    
    #ai-chat-x-main-layout > div.ant-layout {
        height: calc(100vh - 40px);
        height: calc(100dvh - 40px);
        height: calc(100svh - 40px);
    }
    
    #ai-chat-x-history {
        height: calc(100vh - 230px);
        height: calc(100dvh - 230px);
        height: calc(100svh - 230px);
        maxHeight: calc(100dvh - 230px);
        maxHeight: calc(100svh - 230px);
    }
}

/* 超小屏幕横屏处理 */
@media screen and (max-width: 844px) and (max-height: 480px) and (orientation: landscape) {
    #ai-chat-x-header {
        height: 35px !important;
        min-height: 35px !important;
    }
    
    .ai-chat-x-header-row {
        height: 30px !important;
        min-height: 30px !important;
        padding: 4px 8px !important;
    }
    
    #ai-chat-x-main-layout > div.ant-layout {
        height: calc(100vh - 35px);
        height: calc(100dvh - 35px);
        height: calc(100svh - 35px);
    }
    
    #ai-chat-x-history {
        height: calc(100vh - 225px);
        height: calc(100dvh - 225px);
        height: calc(100svh - 225px);
        maxHeight: calc(100dvh - 225px);
        maxHeight: calc(100svh - 225px);
    }
}

/* 安全区域处理 - 支持iPhone X等有刘海屏的设备 */
@supports (padding: max(0px)) {
    @media screen and (max-width: 768px) {
        #ai-chat-x-main-layout {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        
        #ai-chat-x-header {
            padding-top: env(safe-area-inset-top);
        }
    }
}

/* 防止内容溢出的额外保护 */
@media screen and (max-width: 768px) {
    /* 确保所有容器都有最小高度限制 */
    #ai-chat-x-main-layout,
    #ai-chat-x-main-layout > div,
    #ai-chat-x-right-content,
    #ai-chat-x-history {
        min-height: 0 !important;
        min-width: 0 !important;
    }
    
    /* 防止flex子元素溢出 */
    .ant-layout,
    .ant-layout-content,
    .ant-layout-footer {
        min-height: 0 !important;
        min-width: 0 !important;
    }
    
    /* 确保滚动容器正常工作 */
    #ai-chat-x-history {
        overflow-y: auto !important;
        overflow-x: hidden !important;
    }
}
