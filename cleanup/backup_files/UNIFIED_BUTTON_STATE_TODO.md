# ç»Ÿä¸€æŒ‰é’®çŠ¶æ€ç®¡ç† - å¼€å‘TODOåˆ—è¡¨

## é¡¹ç›®æ¦‚è¿°

**ç›®æ ‡**: å®ç°æ–‡æœ¬æŒ‰é’®ã€å½•éŸ³æŒ‰é’®ã€é€šè¯æŒ‰é’®çš„ç»Ÿä¸€çŠ¶æ€ç®¡ç†
**é¢„è®¡å·¥æœŸ**: 2-3å¤©
**ä¼˜å…ˆçº§**: P0 (é«˜ä¼˜å…ˆçº§)

---

## Phase 1: åŸºç¡€æ¶æ„æ­å»º (é¢„è®¡4å°æ—¶)

### 1.1 åˆ›å»ºç»Ÿä¸€çŠ¶æ€ç®¡ç†å™¨ â° 2å°æ—¶
- [ ] åˆ›å»ºæ–‡ä»¶ `assets/js/unified_button_state_manager.js`
- [ ] å®šä¹‰ `UnifiedButtonStateManager` ç±»
- [ ] å®šä¹‰å…¨å±€çŠ¶æ€æšä¸¾ `GLOBAL_STATES`
- [ ] å®ç°æ„é€ å‡½æ•°å’Œåˆå§‹åŒ–æ–¹æ³•
- [ ] å®ç°çŠ¶æ€å¤„ç†å™¨æ˜ å°„ `initStateHandlers()`

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ–‡ä»¶åˆ›å»ºæˆåŠŸ
- âœ… ç±»ç»“æ„å®Œæ•´
- âœ… 7ä¸ªå…¨å±€çŠ¶æ€æ­£ç¡®å®šä¹‰
- âœ… æ§åˆ¶å°è¾“å‡ºåˆå§‹åŒ–æˆåŠŸæ—¥å¿—

**å…³é”®ä»£ç **:
```javascript
class UnifiedButtonStateManager {
    constructor() {
        this.GLOBAL_STATES = {
            IDLE: 'idle',
            TEXT_PROCESSING: 'text_processing',
            RECORDING: 'recording',
            VOICE_PROCESSING: 'voice_processing',
            PREPARING_TTS: 'preparing_tts',
            PLAYING_TTS: 'playing_tts',
            CALLING: 'calling'
        };
        this.currentState = this.GLOBAL_STATES.IDLE;
        this.stateHandlers = new Map();
        this.initStateHandlers();
    }
}
```

---

### 1.2 å®ç°æŒ‰é’®æ›´æ–°æ–¹æ³• â° 1å°æ—¶
- [ ] å®ç° `updateTextButton(label, disabled, loading)`
- [ ] å®ç° `updateRecordButton(label, icon, color, clickable)`
- [ ] å®ç° `updateCallButton(label, icon, color, clickable)`
- [ ] æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è¾“å‡º

**éªŒæ”¶æ ‡å‡†**:
- âœ… ä¸‰ä¸ªæ–¹æ³•æ­£ç¡®æ›´æ–°å¯¹åº”æŒ‰é’®
- âœ… Dashå±æ€§æ­£ç¡®è®¾ç½®
- âœ… æ—¥å¿—è¾“å‡ºæ¸…æ™°å¯è¯»

**æµ‹è¯•æ–¹æ³•**:
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•
window.unifiedButtonStateManager.updateTextButton('æµ‹è¯•', true, true);
window.unifiedButtonStateManager.updateRecordButton('å½•éŸ³', 'ğŸ¤', '#ff4d4f', true);
window.unifiedButtonStateManager.updateCallButton('é€šè¯', 'ğŸ“', '#52c41a', true);
```

---

### 1.3 å®ç°çŠ¶æ€åˆ‡æ¢æ–¹æ³• â° 1å°æ—¶
- [ ] å®ç° `setState(newState)` æ ¸å¿ƒæ–¹æ³•
- [ ] å®ç°åœºæ™¯è½¬æ¢æ–¹æ³•ï¼š
  - [ ] `startTextProcessing()`
  - [ ] `startRecording()`
  - [ ] `stopRecording()`
  - [ ] `sttCompleted()`
  - [ ] `prepareForTTS()`
  - [ ] `startPlayingTTS()`
  - [ ] `stopPlayingOrComplete()`
  - [ ] `resetToIdle()`

**éªŒæ”¶æ ‡å‡†**:
- âœ… çŠ¶æ€åˆ‡æ¢æ—¥å¿—æ¸…æ™°
- âœ… çŠ¶æ€å¤„ç†å™¨æ­£ç¡®æ‰§è¡Œ
- âœ… æŒ‰é’®çŠ¶æ€æ­£ç¡®æ›´æ–°

**æµ‹è¯•æ–¹æ³•**:
```javascript
// æµ‹è¯•çŠ¶æ€åˆ‡æ¢
window.unifiedButtonStateManager.startTextProcessing();
// è§‚å¯ŸæŒ‰é’®å˜åŒ–
window.unifiedButtonStateManager.resetToIdle();
// è§‚å¯ŸæŒ‰é’®æ¢å¤
```

---

## Phase 2: è¾“å…¥éªŒè¯åŠŸèƒ½ (é¢„è®¡2å°æ—¶)

### 2.1 å®ç°è¾“å…¥æ¡†å†…å®¹æ£€æŸ¥ â° 0.5å°æ—¶
- [ ] å®ç° `checkInputContent()` æ–¹æ³•
- [ ] æ£€æŸ¥è¾“å…¥æ¡†å…ƒç´ æ˜¯å¦å­˜åœ¨
- [ ] æ£€æŸ¥è¾“å…¥æ¡†å†…å®¹æ˜¯å¦ä¸ºç©º
- [ ] æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è¾“å‡º

**éªŒæ”¶æ ‡å‡†**:
- âœ… è¾“å…¥æ¡†ä¸ºç©ºæ—¶è¿”å› false
- âœ… è¾“å…¥æ¡†æœ‰å†…å®¹æ—¶è¿”å› true
- âœ… è¾“å…¥æ¡†ä¸å­˜åœ¨æ—¶è¿”å› false å¹¶è­¦å‘Š

**æµ‹è¯•æ–¹æ³•**:
```javascript
// æ¸…ç©ºè¾“å…¥æ¡†
document.getElementById('ai-chat-x-input').value = '';
console.log(window.unifiedButtonStateManager.checkInputContent()); // false

// è¾“å…¥å†…å®¹
document.getElementById('ai-chat-x-input').value = 'æµ‹è¯•æ¶ˆæ¯';
console.log(window.unifiedButtonStateManager.checkInputContent()); // true
```

---

### 2.2 å®ç°ç©ºè¾“å…¥è­¦å‘Šæç¤º â° 0.5å°æ—¶
- [ ] å®ç° `showInputEmptyWarning()` æ–¹æ³•
- [ ] ä½¿ç”¨ Ant Design Message ç»„ä»¶æ˜¾ç¤ºæç¤º
- [ ] ä½¿ç”¨ Dash clientside æ›´æ–° global-message

**éªŒæ”¶æ ‡å‡†**:
- âœ… è¾“å…¥æ¡†ä¸ºç©ºæäº¤æ—¶æ˜¾ç¤ºè­¦å‘Š
- âœ… è­¦å‘Šæç¤ºå‹å¥½æ˜“æ‡‚
- âœ… æç¤ºè‡ªåŠ¨æ¶ˆå¤±

**æµ‹è¯•æ–¹æ³•**:
```javascript
window.unifiedButtonStateManager.showInputEmptyWarning();
// åº”è¯¥çœ‹åˆ°è­¦å‘Šæç¤º
```

---

### 2.3 å®ç°æ–‡æœ¬æŒ‰é’®ç‚¹å‡»å¤„ç† â° 1å°æ—¶
- [ ] å®ç° `handleTextButtonClick()` æ–¹æ³•
- [ ] æ£€æŸ¥å½“å‰çŠ¶æ€æ˜¯å¦å…è®¸æäº¤
- [ ] æ£€æŸ¥è¾“å…¥æ¡†å†…å®¹
- [ ] è°ƒç”¨çŠ¶æ€åˆ‡æ¢æ–¹æ³•
- [ ] è¿”å›å¤„ç†ç»“æœ

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç©ºé—²çŠ¶æ€ä¸”è¾“å…¥æ¡†æœ‰å†…å®¹æ—¶è¿”å› true
- âœ… è¾“å…¥æ¡†ä¸ºç©ºæ—¶è¿”å› false å¹¶æ˜¾ç¤ºè­¦å‘Š
- âœ… éç©ºé—²çŠ¶æ€æ—¶è¿”å› false

**æµ‹è¯•æ–¹æ³•**:
```javascript
// æµ‹è¯•ç©ºè¾“å…¥
document.getElementById('ai-chat-x-input').value = '';
console.log(window.unifiedButtonStateManager.handleTextButtonClick()); // false

// æµ‹è¯•æœ‰å†…å®¹
document.getElementById('ai-chat-x-input').value = 'æµ‹è¯•';
console.log(window.unifiedButtonStateManager.handleTextButtonClick()); // true
```

---

## Phase 3: æŒ‰é’®ç‚¹å‡»å¤„ç† (é¢„è®¡2å°æ—¶)

### 3.1 å®ç°å½•éŸ³æŒ‰é’®ç‚¹å‡»å¤„ç† â° 1å°æ—¶
- [ ] å®ç° `handleRecordButtonClick()` æ–¹æ³•
- [ ] å¤„ç†ç©ºé—²çŠ¶æ€ï¼šå¼€å§‹å½•éŸ³
- [ ] å¤„ç†å½•éŸ³çŠ¶æ€ï¼šåœæ­¢å½•éŸ³
- [ ] å¤„ç†æ’­æ”¾çŠ¶æ€ï¼šåœæ­¢æ’­æ”¾
- [ ] å…¶ä»–çŠ¶æ€æ‹’ç»æ“ä½œ

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç©ºé—²çŠ¶æ€ç‚¹å‡»å¼€å§‹å½•éŸ³
- âœ… å½•éŸ³çŠ¶æ€ç‚¹å‡»åœæ­¢å½•éŸ³
- âœ… æ’­æ”¾çŠ¶æ€ç‚¹å‡»åœæ­¢æ’­æ”¾
- âœ… å…¶ä»–çŠ¶æ€æ‹’ç»æ“ä½œ

**æµ‹è¯•æ–¹æ³•**:
```javascript
// æµ‹è¯•å¼€å§‹å½•éŸ³
window.unifiedButtonStateManager.handleRecordButtonClick();
// åº”è¯¥çœ‹åˆ°çŠ¶æ€å˜ä¸º recording

// æµ‹è¯•åœæ­¢å½•éŸ³
window.unifiedButtonStateManager.handleRecordButtonClick();
// åº”è¯¥çœ‹åˆ°çŠ¶æ€å˜ä¸º voice_processing
```

---

### 3.2 å®ç°é€šè¯æŒ‰é’®ç‚¹å‡»å¤„ç† â° 1å°æ—¶
- [ ] å®ç° `handleCallButtonClick()` æ–¹æ³•
- [ ] å¤„ç†ç©ºé—²çŠ¶æ€ï¼šå¼€å§‹é€šè¯
- [ ] å¤„ç†é€šè¯çŠ¶æ€ï¼šåœæ­¢é€šè¯
- [ ] å…¶ä»–çŠ¶æ€æ‹’ç»æ“ä½œ
- [ ] æ·»åŠ æœªæ¥å®ç°çš„å ä½ç¬¦

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç©ºé—²çŠ¶æ€ç‚¹å‡»å¼€å§‹é€šè¯
- âœ… é€šè¯çŠ¶æ€ç‚¹å‡»åœæ­¢é€šè¯
- âœ… å…¶ä»–çŠ¶æ€æ‹’ç»æ“ä½œ
- âœ… æ˜¾ç¤ºæœªæ¥å®ç°æç¤º

**æµ‹è¯•æ–¹æ³•**:
```javascript
// æµ‹è¯•å¼€å§‹é€šè¯
window.unifiedButtonStateManager.handleCallButtonClick();
// åº”è¯¥çœ‹åˆ°çŠ¶æ€å˜ä¸º calling

// æµ‹è¯•åœæ­¢é€šè¯
window.unifiedButtonStateManager.handleCallButtonClick();
// åº”è¯¥çœ‹åˆ°çŠ¶æ€å˜ä¸º idle
```

---

## Phase 4: å‰ç«¯é›†æˆ (é¢„è®¡3å°æ—¶)

### 4.1 åœ¨app.pyä¸­å¼•å…¥è„šæœ¬ â° 0.5å°æ—¶
- [ ] ä¿®æ”¹ `app.py` çš„ `index_string`
- [ ] åœ¨ `<footer>` ä¸­æ·»åŠ è„šæœ¬æ ‡ç­¾
- [ ] ç¡®ä¿è„šæœ¬åŠ è½½é¡ºåºæ­£ç¡®
- [ ] æµ‹è¯•è„šæœ¬åŠ è½½æˆåŠŸ

**éªŒæ”¶æ ‡å‡†**:
- âœ… é¡µé¢åŠ è½½æ—¶è„šæœ¬æ­£ç¡®å¼•å…¥
- âœ… æ§åˆ¶å°æ˜¾ç¤ºåˆå§‹åŒ–æ—¥å¿—
- âœ… å…¨å±€å¯¹è±¡ `window.unifiedButtonStateManager` å¯ç”¨

**å…³é”®ä»£ç **:
```python
app.index_string = '''
<!DOCTYPE html>
<html>
    <head>
        {%metas%}
        <title>{%title%}</title>
        {%favicon%}
        {%css%}
    </head>
    <body>
        {%app_entry%}
        <footer>
            {%config%}
            {%scripts%}
            <script src="/assets/js/unified_button_state_manager.js"></script>
            <script src="/assets/js/voice_state_manager.js"></script>
            <script src="/assets/js/voice_recorder_enhanced.js"></script>
            <script src="/assets/js/voice_player_enhanced.js"></script>
            {%renderer%}
        </footer>
    </body>
</html>
'''
```

---

### 4.2 å½•éŸ³å™¨é›†æˆ â° 1å°æ—¶
- [ ] ä¿®æ”¹ `voice_recorder_enhanced.js`
- [ ] åœ¨ `startRecording()` ä¸­è°ƒç”¨çŠ¶æ€ç®¡ç†å™¨
- [ ] åœ¨ `stopRecording()` ä¸­è°ƒç”¨çŠ¶æ€ç®¡ç†å™¨
- [ ] åœ¨ STT å®Œæˆæ—¶é€šçŸ¥çŠ¶æ€ç®¡ç†å™¨
- [ ] ç§»é™¤æ—§çš„çŠ¶æ€ç®¡ç†é€»è¾‘

**éªŒæ”¶æ ‡å‡†**:
- âœ… å½•éŸ³å¼€å§‹æ—¶æŒ‰é’®å˜çº¢è‰²
- âœ… å½•éŸ³åœæ­¢æ—¶æŒ‰é’®å˜é»„è‰²
- âœ… STTå®Œæˆæ—¶æ–‡æœ¬æŒ‰é’®å˜busy

**ä¿®æ”¹ä½ç½®**:
- `startRecording()` å¼€å§‹å¤„
- `stopRecording()` å¼€å§‹å¤„
- `handleTranscriptionResult()` å®Œæˆå¤„

---

### 4.3 æ’­æ”¾å™¨é›†æˆ â° 1å°æ—¶
- [ ] ä¿®æ”¹ `voice_player_enhanced.js`
- [ ] åœ¨æ’­æ”¾å¼€å§‹æ—¶è°ƒç”¨çŠ¶æ€ç®¡ç†å™¨
- [ ] åœ¨æ’­æ”¾ç»“æŸæ—¶è°ƒç”¨çŠ¶æ€ç®¡ç†å™¨
- [ ] åœ¨æ’­æ”¾é”™è¯¯æ—¶é‡ç½®çŠ¶æ€
- [ ] ç§»é™¤æ—§çš„çŠ¶æ€ç®¡ç†é€»è¾‘

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ’­æ”¾å¼€å§‹æ—¶å½•éŸ³æŒ‰é’®å˜ç»¿è‰²
- âœ… æ’­æ”¾ç»“æŸæ—¶æ‰€æœ‰æŒ‰é’®æ¢å¤
- âœ… æ’­æ”¾é”™è¯¯æ—¶æ‰€æœ‰æŒ‰é’®æ¢å¤

**ä¿®æ”¹ä½ç½®**:
- `synthesizeAndPlay()` å¼€å§‹å¤„
- `onended` å›è°ƒä¸­
- é”™è¯¯å¤„ç†ä¸­

---

### 4.4 æ·»åŠ å®¢æˆ·ç«¯å›è°ƒ â° 0.5å°æ—¶
- [ ] åœ¨ `app.py` ä¸­æ³¨å†Œå®¢æˆ·ç«¯å›è°ƒ
- [ ] éªŒè¯è¾“å…¥æ¡†å†…å®¹
- [ ] è°ƒç”¨çŠ¶æ€ç®¡ç†å™¨æ£€æŸ¥çŠ¶æ€
- [ ] è¿”å›éªŒè¯ç»“æœ

**éªŒæ”¶æ ‡å‡†**:
- âœ… è¾“å…¥æ¡†ä¸ºç©ºæ—¶é˜»æ­¢æäº¤
- âœ… éç©ºé—²çŠ¶æ€æ—¶é˜»æ­¢æäº¤
- âœ… éªŒè¯é€šè¿‡æ—¶å…è®¸æäº¤

**å…³é”®ä»£ç **:
```python
app.clientside_callback(
    """
    function(n_clicks, input_value) {
        if (!n_clicks) return window.dash_clientside.no_update;
        if (!input_value || !input_value.trim()) {
            console.log('è¾“å…¥æ¡†ä¸ºç©ºï¼Œé˜»æ­¢æäº¤');
            return window.dash_clientside.no_update;
        }
        if (window.unifiedButtonStateManager) {
            const canProceed = window.unifiedButtonStateManager.handleTextButtonClick();
            if (!canProceed) return window.dash_clientside.no_update;
        }
        return n_clicks;
    }
    """,
    Output('ai-chat-x-send-btn', 'n_clicks', allow_duplicate=True),
    Input('ai-chat-x-send-btn', 'n_clicks'),
    State('ai-chat-x-input', 'value'),
    prevent_initial_call=True
)
```

---

## Phase 5: åç«¯é›†æˆ (é¢„è®¡2å°æ—¶)

### 5.1 ä¿®æ”¹æ–‡æœ¬æäº¤å›è°ƒ â° 1å°æ—¶
- [ ] ä¿®æ”¹ `callbacks/core_pages_c/chat_input_area_c.py`
- [ ] åœ¨å›è°ƒå¼€å§‹å¤„éªŒè¯è¾“å…¥æ¡†
- [ ] è¾“å…¥æ¡†ä¸ºç©ºæ—¶è¿”å› no_update
- [ ] SSE å¼€å§‹æ—¶ä¿æŒ busy çŠ¶æ€
- [ ] SSE ç»“æŸæ—¶é€šçŸ¥å‰ç«¯å‡†å¤‡ TTS

**éªŒæ”¶æ ‡å‡†**:
- âœ… è¾“å…¥æ¡†ä¸ºç©ºæ—¶æœåŠ¡ç«¯æ‹’ç»å¤„ç†
- âœ… SSE æµå¼è¿”å›æ—¶æŒ‰é’®ä¿æŒbusy
- âœ… SSE ç»“æŸæ—¶æ­£ç¡®é€šçŸ¥å‰ç«¯

**ä¿®æ”¹ä½ç½®**:
```python
def handle_message_submit(...):
    # åœ¨å‡½æ•°å¼€å§‹å¤„æ·»åŠ 
    if not input_value or not input_value.strip():
        log.info('è¾“å…¥æ¡†ä¸ºç©ºï¼Œä¸å¤„ç†æäº¤')
        return no_update, no_update, False, False, no_update
    
    # åŸæœ‰å¤„ç†é€»è¾‘...
```

---

### 5.2 SSEå®Œæˆé€šçŸ¥å¤„ç† â° 1å°æ—¶
- [ ] åœ¨ SSE æµç»“æŸæ—¶å‘é€é€šçŸ¥
- [ ] å‰ç«¯æ¥æ”¶é€šçŸ¥åè°ƒç”¨ `prepareForTTS()`
- [ ] å¦‚æœå¯ç”¨è¯­éŸ³è‡ªåŠ¨æ’­æ”¾åˆ™è§¦å‘ TTS
- [ ] å¦‚æœæœªå¯ç”¨åˆ™ç›´æ¥ `resetToIdle()`

**éªŒæ”¶æ ‡å‡†**:
- âœ… SSE ç»“æŸåæŒ‰é’®çŠ¶æ€æ­£ç¡®
- âœ… å¯ç”¨è‡ªåŠ¨æ’­æ”¾æ—¶è‡ªåŠ¨è§¦å‘ TTS
- âœ… æœªå¯ç”¨æ—¶ç›´æ¥æ¢å¤ç©ºé—²çŠ¶æ€

**ä¿®æ”¹ä½ç½®**:
- SSE æµç»“æŸå¤„ç†
- TTS è§¦å‘é€»è¾‘

---

## Phase 6: æµ‹è¯•å’Œä¼˜åŒ– (é¢„è®¡4å°æ—¶)

### 6.1 åœºæ™¯ä¸€æµ‹è¯• â° 1å°æ—¶
- [ ] æµ‹è¯•è¾“å…¥æ¡†ä¸ºç©ºæäº¤
- [ ] æµ‹è¯•è¾“å…¥æ¡†æœ‰å†…å®¹æäº¤
- [ ] æµ‹è¯• SSE æµå¼è¿”å›
- [ ] æµ‹è¯• TTS è‡ªåŠ¨æ’­æ”¾
- [ ] æµ‹è¯•æ’­æ”¾ä¸­æ–­
- [ ] æµ‹è¯•æ’­æ”¾å®Œæˆ

**æµ‹è¯•ç”¨ä¾‹**:
1. ç©ºè¾“å…¥æ¡†ç‚¹å‡»å‘é€ â†’ æ˜¾ç¤ºè­¦å‘Š
2. è¾“å…¥å†…å®¹ç‚¹å‡»å‘é€ â†’ æ–‡æœ¬busyï¼Œå½•éŸ³ç°è‰²
3. SSEè¿”å›ä¸­ â†’ æŒ‰é’®ä¿æŒçŠ¶æ€
4. SSEç»“æŸ â†’ å½•éŸ³æŒ‰é’®å˜é»„è‰²
5. TTSå¼€å§‹ â†’ å½•éŸ³æŒ‰é’®å˜ç»¿è‰²
6. ç‚¹å‡»åœæ­¢ â†’ æ‰€æœ‰æŒ‰é’®æ¢å¤
7. è‡ªåŠ¨å®Œæˆ â†’ æ‰€æœ‰æŒ‰é’®æ¢å¤

---

### 6.2 åœºæ™¯äºŒæµ‹è¯• â° 1å°æ—¶
- [ ] æµ‹è¯•å¼€å§‹å½•éŸ³
- [ ] æµ‹è¯•å½•éŸ³ä¸­
- [ ] æµ‹è¯•åœæ­¢å½•éŸ³
- [ ] æµ‹è¯• STT å¤„ç†
- [ ] æµ‹è¯• SSE è¿”å›
- [ ] æµ‹è¯• TTS æ’­æ”¾
- [ ] æµ‹è¯•æ’­æ”¾å®Œæˆ

**æµ‹è¯•ç”¨ä¾‹**:
1. ç‚¹å‡»å½•éŸ³ â†’ å½•éŸ³æŒ‰é’®å˜çº¢è‰²
2. å½•éŸ³ä¸­ â†’ æ–‡æœ¬å’Œé€šè¯æŒ‰é’®ç°è‰²
3. ç‚¹å‡»åœæ­¢ â†’ å½•éŸ³æŒ‰é’®å˜é»„è‰²
4. STTå®Œæˆ â†’ æ–‡æœ¬æŒ‰é’®busyï¼Œå½•éŸ³ä¿æŒé»„è‰²
5. SSEè¿”å›ä¸­ â†’ æŒ‰é’®ä¿æŒçŠ¶æ€
6. SSEç»“æŸ â†’ å½•éŸ³æŒ‰é’®ä¿æŒé»„è‰²
7. TTSå¼€å§‹ â†’ å½•éŸ³æŒ‰é’®å˜ç»¿è‰²
8. æ’­æ”¾å®Œæˆ â†’ æ‰€æœ‰æŒ‰é’®æ¢å¤

---

### 6.3 è¾¹ç•Œæƒ…å†µæµ‹è¯• â° 1å°æ—¶
- [ ] æµ‹è¯•å¿«é€Ÿè¿ç»­ç‚¹å‡»
- [ ] æµ‹è¯•çŠ¶æ€åˆ‡æ¢ä¸­ç‚¹å‡»
- [ ] æµ‹è¯•ç½‘ç»œé”™è¯¯æ¢å¤
- [ ] æµ‹è¯• STT å¤±è´¥æ¢å¤
- [ ] æµ‹è¯• TTS å¤±è´¥æ¢å¤
- [ ] æµ‹è¯•é¡µé¢åˆ·æ–°çŠ¶æ€

**æµ‹è¯•ç”¨ä¾‹**:
1. å¿«é€Ÿè¿ç»­ç‚¹å‡»å½•éŸ³æŒ‰é’®
2. å½•éŸ³ä¸­å¿«é€Ÿç‚¹å‡»æ–‡æœ¬æŒ‰é’®
3. SSEæ–­å¼€è¿æ¥
4. STTè¿”å›é”™è¯¯
5. TTSæ’­æ”¾å¤±è´¥
6. å¤„ç†ä¸­åˆ·æ–°é¡µé¢

---

### 6.4 æ€§èƒ½ä¼˜åŒ– â° 1å°æ—¶
- [ ] ä¼˜åŒ–çŠ¶æ€åˆ‡æ¢é¢‘ç‡
- [ ] å‡å°‘DOMæ“ä½œæ¬¡æ•°
- [ ] ä¼˜åŒ–æ—¥å¿—è¾“å‡ºé‡
- [ ] æ·»åŠ çŠ¶æ€åˆ‡æ¢é˜²æŠ–
- [ ] ä¼˜åŒ–æŒ‰é’®æ›´æ–°é€»è¾‘

**ä¼˜åŒ–æŒ‡æ ‡**:
- çŠ¶æ€åˆ‡æ¢å»¶è¿Ÿ < 50ms
- æŒ‰é’®å“åº”æ—¶é—´ < 100ms
- å†…å­˜å ç”¨ < 1MB
- CPUå ç”¨ < 5%

---

## Phase 7: æ–‡æ¡£å’Œæ¸…ç† (é¢„è®¡1å°æ—¶)

### 7.1 æ›´æ–°æ–‡æ¡£ â° 0.5å°æ—¶
- [ ] æ›´æ–°å¼€å‘æ–‡æ¡£
- [ ] æ·»åŠ APIæ–‡æ¡£
- [ ] æ·»åŠ ä½¿ç”¨ç¤ºä¾‹
- [ ] æ›´æ–°æµ‹è¯•æŠ¥å‘Š

---

### 7.2 ä»£ç æ¸…ç† â° 0.5å°æ—¶
- [ ] ç§»é™¤æ—§çš„çŠ¶æ€ç®¡ç†ä»£ç 
- [ ] ç§»é™¤è°ƒè¯•æ—¥å¿—
- [ ] ç»Ÿä¸€ä»£ç é£æ ¼
- [ ] æ·»åŠ ä»£ç æ³¨é‡Š

---

## éªŒæ”¶æ£€æŸ¥æ¸…å•

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] åœºæ™¯ä¸€æ‰€æœ‰çŠ¶æ€æ­£ç¡®
- [ ] åœºæ™¯äºŒæ‰€æœ‰çŠ¶æ€æ­£ç¡®
- [ ] è¾“å…¥æ¡†éªŒè¯å·¥ä½œæ­£å¸¸
- [ ] æŒ‰é’®ç‚¹å‡»å¤„ç†æ­£ç¡®
- [ ] é”™è¯¯å¤„ç†å®Œå–„

### ä»£ç è´¨é‡
- [ ] ä»£ç ç»“æ„æ¸…æ™°
- [ ] æ³¨é‡Šå®Œæ•´
- [ ] æ— å†—ä½™ä»£ç 
- [ ] æ— æ§åˆ¶å°é”™è¯¯
- [ ] æ— æ§åˆ¶å°è­¦å‘Š

### ç”¨æˆ·ä½“éªŒ
- [ ] æŒ‰é’®çŠ¶æ€åˆ‡æ¢æµç•…
- [ ] è§†è§‰åé¦ˆæ¸…æ™°
- [ ] é”™è¯¯æç¤ºå‹å¥½
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡

### æ–‡æ¡£å®Œæ•´æ€§
- [ ] å¼€å‘æ–‡æ¡£å®Œæ•´
- [ ] APIæ–‡æ¡£æ¸…æ™°
- [ ] æµ‹è¯•ç”¨ä¾‹é½å…¨
- [ ] ä½¿ç”¨ç¤ºä¾‹å……åˆ†

---

## é£é™©è¯„ä¼°

| é£é™©é¡¹ | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|--------|------|------|----------|
| çŠ¶æ€åŒæ­¥é—®é¢˜ | ä¸­ | é«˜ | ä½¿ç”¨äº‹ä»¶é©±åŠ¨æœºåˆ¶ç¡®ä¿åŒæ­¥ |
| æ€§èƒ½é—®é¢˜ | ä½ | ä¸­ | ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµä¼˜åŒ– |
| å…¼å®¹æ€§é—®é¢˜ | ä½ | ä¸­ | æµ‹è¯•å¤šç§æµè§ˆå™¨ |
| é›†æˆå†²çª | ä¸­ | é«˜ | é€æ­¥é›†æˆï¼Œå……åˆ†æµ‹è¯• |

---

## èµ„æºéœ€æ±‚

- **å¼€å‘äººå‘˜**: 1äºº
- **é¢„è®¡å·¥æœŸ**: 2-3å¤©
- **æµ‹è¯•äººå‘˜**: 1äººï¼ˆå…¼èŒï¼‰
- **è¯„å®¡äººå‘˜**: 1äºº

---

## æ—¶é—´èŠ‚ç‚¹

| é˜¶æ®µ | å¼€å§‹æ—¥æœŸ | ç»“æŸæ—¥æœŸ | çŠ¶æ€ |
|------|----------|----------|------|
| Phase 1 | å¾…å®š | å¾…å®š | â¸ï¸ å¾…å¼€å§‹ |
| Phase 2 | å¾…å®š | å¾…å®š | â¸ï¸ å¾…å¼€å§‹ |
| Phase 3 | å¾…å®š | å¾…å®š | â¸ï¸ å¾…å¼€å§‹ |
| Phase 4 | å¾…å®š | å¾…å®š | â¸ï¸ å¾…å¼€å§‹ |
| Phase 5 | å¾…å®š | å¾…å®š | â¸ï¸ å¾…å¼€å§‹ |
| Phase 6 | å¾…å®š | å¾…å®š | â¸ï¸ å¾…å¼€å§‹ |
| Phase 7 | å¾…å®š | å¾…å®š | â¸ï¸ å¾…å¼€å§‹ |

---

## è”ç³»äºº

- **é¡¹ç›®è´Ÿè´£äºº**: å¾…å®š
- **æŠ€æœ¯è´Ÿè´£äºº**: å¾…å®š
- **æµ‹è¯•è´Ÿè´£äºº**: å¾…å®š

---

## å¤‡æ³¨

1. æœ¬TODOåˆ—è¡¨ä¼šæ ¹æ®å®é™…å¼€å‘è¿›åº¦åŠ¨æ€è°ƒæ•´
2. æ¯ä¸ªä»»åŠ¡å®Œæˆåéœ€è¦åœ¨å¯¹åº”çš„checkboxæ‰“å‹¾
3. é‡åˆ°é—®é¢˜åŠæ—¶æ›´æ–°é£é™©è¯„ä¼°
4. æ¯ä¸ªPhaseå®Œæˆåè¿›è¡Œé˜¶æ®µæ€§è¯„å®¡

---

## å¿«é€Ÿå¼€å§‹

### å¼€å‘ç¯å¢ƒå‡†å¤‡
```bash
# ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•
cd /Users/zhangjun/PycharmProjects/yyAsistant

# æ£€æŸ¥å¿…è¦çš„æ–‡ä»¶
ls assets/js/voice_state_manager.js
ls assets/js/voice_recorder_enhanced.js
ls assets/js/voice_player_enhanced.js
```

### ç¬¬ä¸€ä¸ªä»»åŠ¡
ä» Phase 1.1 å¼€å§‹ï¼šåˆ›å»º `assets/js/unified_button_state_manager.js`

### æµ‹è¯•ç¯å¢ƒ
å¯åŠ¨å‰ç«¯å’Œåç«¯æœåŠ¡ï¼Œåœ¨æµè§ˆå™¨æ§åˆ¶å°æµ‹è¯•åŠŸèƒ½

---

**æœ€åæ›´æ–°**: 2025-10-15
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0

