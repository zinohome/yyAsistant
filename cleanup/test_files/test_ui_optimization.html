<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIä¼˜åŒ–åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #40a9ff;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background: #f6ffed; border: 1px solid #b7eb8f; }
        .error { background: #fff2f0; border: 1px solid #ffccc7; }
        .info { background: #e6f7ff; border: 1px solid #91d5ff; }
        #audio-visualizer {
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: #fff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ UIä¼˜åŒ–åŠŸèƒ½æµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•yyAsistantçš„UIä¼˜åŒ–åŠŸèƒ½ã€‚</p>

        <!-- éŸ³é¢‘å¯è§†åŒ–å™¨æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸµ éŸ³é¢‘å¯è§†åŒ–å™¨æµ‹è¯•</h3>
            <canvas id="audio-visualizer" width="80" height="20"></canvas>
            <div style="margin-top: 10px;">
                <button onclick="testAudioVisualizer('idle')">å°±ç»ª</button>
                <button onclick="testAudioVisualizer('listening')">è†å¬ä¸­</button>
                <button onclick="testAudioVisualizer('processing')">å¤„ç†ä¸­</button>
                <button onclick="testAudioVisualizer('speaking')">æ’­æ”¾ä¸­</button>
                <button onclick="testAudioVisualizer('error')">é”™è¯¯</button>
            </div>
            <div id="audio-visualizer-status" class="status info">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- æ’­æ”¾çŠ¶æ€æŒ‡ç¤ºå™¨æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ”Š æ’­æ”¾çŠ¶æ€æŒ‡ç¤ºå™¨æµ‹è¯•</h3>
            <div style="margin: 10px 0;">
                <button onclick="testPlaybackStatus('connecting')">è¿æ¥ä¸­</button>
                <button onclick="testPlaybackStatus('listening')">è†å¬ä¸­</button>
                <button onclick="testPlaybackStatus('processing')">å¤„ç†ä¸­</button>
                <button onclick="testPlaybackStatus('speaking')">æ’­æ”¾ä¸­</button>
                <button onclick="testPlaybackStatus('error')">é”™è¯¯</button>
                <button onclick="testPlaybackStatus('retrying')">é‡è¯•ä¸­</button>
            </div>
            <div id="playback-status-status" class="status info">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- é”™è¯¯å¤„ç†æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ›¡ï¸ æ™ºèƒ½é”™è¯¯å¤„ç†æµ‹è¯•</h3>
            <div style="margin: 10px 0;">
                <button onclick="testErrorHandler('WebSocketè¿æ¥å¤±è´¥')">WebSocketé”™è¯¯</button>
                <button onclick="testErrorHandler('è¯­éŸ³åˆæˆå¤±è´¥')">è¯­éŸ³åˆæˆé”™è¯¯</button>
                <button onclick="testErrorHandler('éŸ³é¢‘æ’­æ”¾å¤±è´¥')">éŸ³é¢‘æ’­æ”¾é”™è¯¯</button>
                <button onclick="testErrorHandler('ç½‘ç»œè¶…æ—¶')">ç½‘ç»œè¶…æ—¶</button>
                <button onclick="testErrorHandler('æƒé™è¢«æ‹’ç»')">æƒé™é”™è¯¯</button>
            </div>
            <div id="error-handler-status" class="status info">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- çŠ¶æ€åŒæ­¥æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ”„ çŠ¶æ€åŒæ­¥ç®¡ç†å™¨æµ‹è¯•</h3>
            <div style="margin: 10px 0;">
                <button onclick="testStateSync('voice_synthesis', 'idle')">è¯­éŸ³åˆæˆ-å°±ç»ª</button>
                <button onclick="testStateSync('voice_synthesis', 'speaking')">è¯­éŸ³åˆæˆ-æ’­æ”¾ä¸­</button>
                <button onclick="testStateSync('audio_visualizer', 'listening')">éŸ³é¢‘å¯è§†åŒ–-è†å¬ä¸­</button>
                <button onclick="testStateSync('playback_status', 'processing')">æ’­æ”¾çŠ¶æ€-å¤„ç†ä¸­</button>
                <button onclick="showAllStates()">æ˜¾ç¤ºæ‰€æœ‰çŠ¶æ€</button>
            </div>
            <div id="state-sync-status" class="status info">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- çŠ¶æ€é¢„æµ‹æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ”® æ™ºèƒ½çŠ¶æ€é¢„æµ‹æµ‹è¯•</h3>
            <div style="margin: 10px 0;">
                <button onclick="testStatePrediction('idle')">é¢„æµ‹idleçŠ¶æ€</button>
                <button onclick="testStatePrediction('text_processing')">é¢„æµ‹text_processingçŠ¶æ€</button>
                <button onclick="testStatePrediction('voice_synthesis')">é¢„æµ‹voice_synthesisçŠ¶æ€</button>
                <button onclick="showPredictionStats()">æ˜¾ç¤ºé¢„æµ‹ç»Ÿè®¡</button>
            </div>
            <div id="state-prediction-status" class="status info">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- è‡ªé€‚åº”UIæµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ¨ è‡ªé€‚åº”UIæµ‹è¯•</h3>
            <div style="margin: 10px 0;">
                <button onclick="testAdaptiveUI('animationSpeed', 'fast')">å¿«é€ŸåŠ¨ç”»</button>
                <button onclick="testAdaptiveUI('visualDensity', 'compact')">ç´§å‡‘å¸ƒå±€</button>
                <button onclick="testAdaptiveUI('reducedMotion', true)">å‡å°‘åŠ¨ç”»</button>
                <button onclick="testAdaptiveUI('highContrast', true)">é«˜å¯¹æ¯”åº¦</button>
                <button onclick="showPerformanceReport()">æ˜¾ç¤ºæ€§èƒ½æŠ¥å‘Š</button>
            </div>
            <div id="adaptive-ui-status" class="status info">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- ç³»ç»ŸçŠ¶æ€ -->
        <div class="test-section">
            <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
            <div id="system-status" class="status info">æ­£åœ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...</div>
        </div>
    </div>

    <!-- åŠ è½½UIä¼˜åŒ–JavaScriptæ–‡ä»¶ -->
    <script src="/assets/js/enhanced_audio_visualizer.js"></script>
    <script src="/assets/js/enhanced_playback_status.js"></script>
    <script src="/assets/js/smart_error_handler.js"></script>
    <script src="/assets/js/state_sync_manager.js"></script>
    <script src="/assets/js/smart_state_predictor.js"></script>
    <script src="/assets/js/adaptive_ui.js"></script>

    <script>
        // æµ‹è¯•éŸ³é¢‘å¯è§†åŒ–å™¨
        function testAudioVisualizer(state) {
            const status = document.getElementById('audio-visualizer-status');
            try {
                if (window.enhancedAudioVisualizer) {
                    window.enhancedAudioVisualizer.updateState(state, Math.random() * 100);
                    status.className = 'status success';
                    status.textContent = `âœ… éŸ³é¢‘å¯è§†åŒ–å™¨çŠ¶æ€å·²æ›´æ–°: ${state}`;
                } else {
                    status.className = 'status error';
                    status.textContent = 'âŒ éŸ³é¢‘å¯è§†åŒ–å™¨æœªåˆå§‹åŒ–';
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // æµ‹è¯•æ’­æ”¾çŠ¶æ€æŒ‡ç¤ºå™¨
        function testPlaybackStatus(state) {
            const status = document.getElementById('playback-status-status');
            try {
                if (window.enhancedPlaybackStatus) {
                    const options = {
                        showProgress: state === 'processing',
                        showRetry: state === 'error',
                        showCancel: state === 'processing'
                    };
                    window.enhancedPlaybackStatus.showStatus(state, null, options);
                    status.className = 'status success';
                    status.textContent = `âœ… æ’­æ”¾çŠ¶æ€æŒ‡ç¤ºå™¨å·²æ›´æ–°: ${state}`;
                } else {
                    status.className = 'status error';
                    status.textContent = 'âŒ æ’­æ”¾çŠ¶æ€æŒ‡ç¤ºå™¨æœªåˆå§‹åŒ–';
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // æµ‹è¯•é”™è¯¯å¤„ç†
        function testErrorHandler(errorType) {
            const status = document.getElementById('error-handler-status');
            try {
                if (window.smartErrorHandler) {
                    const error = new Error(errorType);
                    const context = { operation: 'test' };
                    const result = window.smartErrorHandler.handleError(error, context);
                    status.className = 'status success';
                    status.textContent = `âœ… é”™è¯¯å·²å¤„ç†: ${result.type} (${result.severity})`;
                } else {
                    status.className = 'status error';
                    status.textContent = 'âŒ é”™è¯¯å¤„ç†å™¨æœªåˆå§‹åŒ–';
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // æµ‹è¯•çŠ¶æ€åŒæ­¥
        function testStateSync(key, state) {
            const status = document.getElementById('state-sync-status');
            try {
                if (window.stateSyncManager) {
                    window.stateSyncManager.updateState(key, state, { test: true });
                    status.className = 'status success';
                    status.textContent = `âœ… çŠ¶æ€å·²æ›´æ–°: ${key} = ${state}`;
                } else {
                    status.className = 'status error';
                    status.textContent = 'âŒ çŠ¶æ€åŒæ­¥ç®¡ç†å™¨æœªåˆå§‹åŒ–';
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // æ˜¾ç¤ºæ‰€æœ‰çŠ¶æ€
        function showAllStates() {
            const status = document.getElementById('state-sync-status');
            try {
                if (window.stateSyncManager) {
                    const allStates = window.stateSyncManager.getAllStates();
                    status.className = 'status info';
                    status.innerHTML = `ğŸ“Š æ‰€æœ‰çŠ¶æ€:<br>${JSON.stringify(allStates, null, 2)}`;
                } else {
                    status.className = 'status error';
                    status.textContent = 'âŒ çŠ¶æ€åŒæ­¥ç®¡ç†å™¨æœªåˆå§‹åŒ–';
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // æµ‹è¯•çŠ¶æ€é¢„æµ‹
        function testStatePrediction(currentState) {
            const status = document.getElementById('state-prediction-status');
            try {
                if (window.smartStatePredictor) {
                    // å…ˆè®°å½•ä¸€äº›è¡Œä¸º
                    window.smartStatePredictor.recordUserAction(currentState, { test: true });
                    const prediction = window.smartStatePredictor.predictNextState(currentState);
                    status.className = 'status success';
                    status.innerHTML = `ğŸ”® é¢„æµ‹ç»“æœ:<br>æœ€å¯èƒ½: ${prediction.mostLikely.state} (${(prediction.confidence * 100).toFixed(1)}%)<br>å¤‡é€‰: ${prediction.alternatives.map(a => a.state).join(', ')}`;
                } else {
                    status.className = 'status error';
                    status.textContent = 'âŒ çŠ¶æ€é¢„æµ‹å™¨æœªåˆå§‹åŒ–';
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // æ˜¾ç¤ºé¢„æµ‹ç»Ÿè®¡
        function showPredictionStats() {
            const status = document.getElementById('state-prediction-status');
            try {
                if (window.smartStatePredictor) {
                    const stats = window.smartStatePredictor.getStats();
                    status.className = 'status info';
                    status.innerHTML = `ğŸ“Š é¢„æµ‹ç»Ÿè®¡:<br>${JSON.stringify(stats, null, 2)}`;
                } else {
                    status.className = 'status error';
                    status.textContent = 'âŒ çŠ¶æ€é¢„æµ‹å™¨æœªåˆå§‹åŒ–';
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // æµ‹è¯•è‡ªé€‚åº”UI
        function testAdaptiveUI(preference, value) {
            const status = document.getElementById('adaptive-ui-status');
            try {
                if (window.adaptiveUI) {
                    window.adaptiveUI.handlePreferenceChange({ [preference]: value });
                    status.className = 'status success';
                    status.textContent = `âœ… åå¥½å·²æ›´æ–°: ${preference} = ${value}`;
                } else {
                    status.className = 'status error';
                    status.textContent = 'âŒ è‡ªé€‚åº”UIæœªåˆå§‹åŒ–';
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // æ˜¾ç¤ºæ€§èƒ½æŠ¥å‘Š
        function showPerformanceReport() {
            const status = document.getElementById('adaptive-ui-status');
            try {
                if (window.adaptiveUI) {
                    const report = window.adaptiveUI.getPerformanceReport();
                    status.className = 'status info';
                    status.innerHTML = `ğŸ“Š æ€§èƒ½æŠ¥å‘Š:<br>${JSON.stringify(report, null, 2)}`;
                } else {
                    status.className = 'status error';
                    status.textContent = 'âŒ è‡ªé€‚åº”UIæœªåˆå§‹åŒ–';
                }
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âŒ é”™è¯¯: ${error.message}`;
            }
        }

        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        function checkSystemStatus() {
            const status = document.getElementById('system-status');
            const components = [
                { name: 'éŸ³é¢‘å¯è§†åŒ–å™¨', obj: window.enhancedAudioVisualizer },
                { name: 'æ’­æ”¾çŠ¶æ€æŒ‡ç¤ºå™¨', obj: window.enhancedPlaybackStatus },
                { name: 'é”™è¯¯å¤„ç†å™¨', obj: window.smartErrorHandler },
                { name: 'çŠ¶æ€åŒæ­¥ç®¡ç†å™¨', obj: window.stateSyncManager },
                { name: 'çŠ¶æ€é¢„æµ‹å™¨', obj: window.smartStatePredictor },
                { name: 'è‡ªé€‚åº”UI', obj: window.adaptiveUI }
            ];

            let allLoaded = true;
            let statusText = '';

            components.forEach(component => {
                if (component.obj) {
                    statusText += `âœ… ${component.name}: å·²åŠ è½½<br>`;
                } else {
                    statusText += `âŒ ${component.name}: æœªåŠ è½½<br>`;
                    allLoaded = false;
                }
            });

            if (allLoaded) {
                status.className = 'status success';
                status.innerHTML = `ğŸ‰ æ‰€æœ‰ç»„ä»¶å·²åŠ è½½!<br>${statusText}`;
            } else {
                status.className = 'status error';
                status.innerHTML = `âš ï¸ éƒ¨åˆ†ç»„ä»¶æœªåŠ è½½:<br>${statusText}`;
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(checkSystemStatus, 1000); // ç­‰å¾…1ç§’è®©æ‰€æœ‰ç»„ä»¶åˆå§‹åŒ–
        });
    </script>
</body>
</html>
